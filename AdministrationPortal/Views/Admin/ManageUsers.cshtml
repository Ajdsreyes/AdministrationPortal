@model List<AdministrationPortal.Models.ViewModels.UserVM>

@{
    ViewData["Title"] = "Manage Users";
}

<div class="page-header">
    <h2>Residents List</h2>

    <div class="page-actions">
        <input id="search"
               type="text"
               placeholder="Search residents..."
               class="search-input" />
    </div>
</div>

<div class="table-card">
    <table class="user-table">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Address</th>
                <th>Contact Number</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td>
                        <img src="@user.PhotoUrl"
                             class="avatar"
                             onerror="this.src='/images/default-avatar.png'" />
                    </td>

                    <td>@user.FullName</td>
                    <td>@user.FullAddress</td>
                    @* Changed ContactNumber to ContactNo to match SQL/VM *@
                    <td>@user.ContactNo</td>

                    <td>
                        <span class="status @(user.IsActive ? "active" : "inactive")">
                            @(user.IsActive ? "Active" : "Deactivated")
                        </span>
                    </td>

                    <td class="actions">
                        @* Changed Id to UserId to match SQL Primary Key *@
                        <a asp-action="ViewUser" asp-route-id="@user.UserId" title="View">
                            <i class="bi bi-eye"></i>
                        </a>

                        <a asp-action="EditUser" asp-route-id="@user.UserId" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </a>

                        @if (user.IsActive)
                        {
                            <a asp-action="Deactivate"
                               asp-route-id="@user.UserId"
                               title="Deactivate">
                                <i class="bi bi-trash"></i>
                            </a>
                        }
                        else
                        {
                            <a asp-action="Reactivate"
                               asp-route-id="@user.UserId"
                               title="Reactivate">
                                <i class="bi bi-arrow-clockwise"></i>
                            </a>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

</div>

@section Scripts {
    <script>
        document.getElementById("search").addEventListener("keyup", function () {
            const q = this.value.toLowerCase();

            document.querySelectorAll("tbody tr").forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(q)
                    ? ""
                    : "none";
            });
        });
    </script>

    <script>
        function confirmDelete(id) {
            // Updated path to use UserId variable
            document.getElementById("confirmDeleteBtn").href =
                "/Admin/Deactivate/" + id;

            new bootstrap.Modal(
                document.getElementById("deleteModal")
            ).show();
        }
    </script>
}