@model AdministrationPortal.Models.ViewModels.ServiceRequestVM
@{
    ViewData["Title"] = "View Service Request";
}

<div class="profile-container">

    <div class="profile-header">
        @* Changed UploadedPhotoUrl to UploadPath *@
        <img src="@Model.UploadPath" class="profile-avatar" onerror="this.src='/images/default-avatar.png'" />

        <div>
            <h2>@Model.FullName</h2>
            @* Changed Status to StatusName *@
            <span class="status @(Model.StatusName.ToLower().Replace(" ", ""))">
                @Model.StatusName
            </span>
        </div>
    </div>

    <div class="profile-card">
        <h4>Personal Information</h4>

        <div class="profile-grid">
            <div><b>First Name:</b> @Model.FirstName</div>
            <div><b>Middle Name:</b> @Model.MiddleName</div>
            <div><b>Last Name:</b> @Model.LastName</div>
            <div><b>Suffix:</b> @Model.Suffix</div>

            <div>
                <b>Date of Birth:</b> @(Model.TimeToClaim.HasValue
                                ? Model.TimeToClaim.Value.ToString(@"hh\:mm")
                                : "—")
            </div>
            <div><b>Age:</b> @Model.Age</div>
            <div><b>Sex:</b> @Model.Sex</div>
            <div><b>Civil Status:</b> @Model.CivilStatus</div>
            <div><b>Religion:</b> @Model.Religion</div>
        </div>
    </div>

    <div class="profile-card">
        <h4>Address</h4>

        <div class="profile-grid">
            @* Changed Street to HouseNoStreet *@
            <div><b>House / Street:</b> @Model.HouseNoStreet</div>
            <div><b>Barangay:</b> @Model.Barangay</div>
            <div><b>City:</b> @Model.City</div>
            <div><b>Province:</b> @Model.Province</div>
            <div><b>Length of Stay:</b> @Model.StayYears years @Model.StayMonths months</div>
        </div>
    </div>

    <div class="profile-card">
        <h4>Contact Information</h4>

        <div class="profile-grid">
            @* Changed ContactNumber to ContactNo *@
            <div><b>Phone:</b> @Model.ContactNo</div>
            <div><b>Email:</b> @Model.Email</div>
        </div>
    </div>

    <div class="profile-card highlight request-details-card">
        <h4>Request Details</h4>

        <form asp-action="UpdateClaimSchedule" method="post">
            @* Changed Id to RequestId *@
            <input type="hidden" name="id" value="@Model.RequestId" />
            <input type="hidden" name="serviceName" value="@ViewBag.ServiceName" />

            <div class="request-grid">

                <div class="request-item">
                    <label>Service</label>
                    <span>@ViewBag.ServiceName</span>
                </div>

                <div class="request-item full">
                    <label>Purpose</label>
                    <span>@Model.Purpose</span>
                </div>

                <div class="request-item">
                    <label>Date to Claim</label>
                    <input type="date"
                           id="dateToClaim"
                           name="DateToClaim"
                           value="@(Model.DateToClaim?.ToString("yyyy-MM-dd"))" />
                </div>

                <div class="request-item">
                    <label>Time to Claim</label>
                    <input type="time"
                           id="timeToClaim"
                           name="TimeToClaim"
                           value="@(Model.TimeToClaim?.ToString(@"hh\:mm"))" />
                </div>

                <div class="request-item">
                    <label>Status</label>
                    <select id="statusSelect" name="Status" class="status-select">
                        @* Using StatusName for selection logic *@
                        <option value="Pending" selected="@(Model.StatusName == "Pending")">Pending</option>
                        <option value="Approved" selected="@(Model.StatusName == "Approved")">Approved</option>
                        <option value="Rejected" selected="@(Model.StatusName == "Rejected")">Rejected</option>
                        <option value="Ready for Claim" selected="@(Model.StatusName == "Ready for Claim")">Ready for Claim</option>
                        <option value="Released" selected="@(Model.StatusName == "Released")">Released</option>
                    </select>
                </div>

            </div>

            <div class="profile-actions">
                <button type="submit" class="btn-primary">
                    Save Changes
                </button>
            </div>
        </form>
    </div>

    <div class="profile-actions">
        <a asp-action="ServiceRequests"
           @* Changed ServiceType to ServiceName *@
           asp-route-service="@Model.ServiceName"
           class="btn-secondary">
            ← Back to Requests
        </a>

    </div>

</div>

@section Scripts {
    <script>
        function toggleClaimInputs() {
            const status = document.getElementById("statusSelect").value;
            const dateInput = document.getElementById("dateToClaim");
            const timeInput = document.getElementById("timeToClaim");

            const enable =
                status === "Approved" ||
                status === "Ready for Claim";

            dateInput.disabled = !enable;
            timeInput.disabled = !enable;

            if (!enable) {
                dateInput.value = "";
                timeInput.value = "";
            }
        }

        document.getElementById("statusSelect")
            .addEventListener("change", toggleClaimInputs);

        // Run on page load
        toggleClaimInputs();
    </script>
}